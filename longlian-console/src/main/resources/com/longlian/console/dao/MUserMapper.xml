<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.longlian.console.dao.MUserMapper">
    <resultMap id="BaseResultMap" type="com.longlian.model.MUser">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="id" jdbcType="BIGINT" property="id"/>
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="password" jdbcType="VARCHAR" property="password"/>
        <result column="gender" jdbcType="VARCHAR" property="gender"/>
        <result column="id_card" jdbcType="VARCHAR" property="idCard"/>
        <result column="status" jdbcType="VARCHAR" property="status"/>
        <result column="tel" jdbcType="VARCHAR" property="tel"/>
        <result column="user_id" jdbcType="VARCHAR" property="userId"/>
        <result column="qq" jdbcType="VARCHAR" property="qq"/>
        <result column="res_id" jdbcType="BIGINT" property="resId"/>
        <result column="email" jdbcType="VARCHAR" property="email"/>
    </resultMap>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        id, name, password, gender, id_card, status, tel, user_id, qq, res_id, email
    </sql>
    <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from m_user
        where id = #{id} AND status not IN ('2')
    </select>

    <select id="selectByUserId" parameterType="java.lang.String" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from m_user
        where user_id = #{userId}
        <!-- 只查能登录的 -->
         <if test="onlyCanLogin">
            and (status = 1 or status = 0)
        </if> 
    </select>

    <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from m_user
        where id = #{id}
    </delete>
    <insert id="insert" parameterType="MUser">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
            SELECT LAST_INSERT_ID()
        </selectKey>
        insert into m_user (name, password, gender, id_card, status, tel, user_id,
        qq, res_id, email)
        values (#{name}, #{password}, #{gender}, #{idCard}, #{status}, #{tel}, #{userId},
        #{qq}, #{resId}, #{email})
    </insert>
    <insert id="insertSelective" parameterType="MUser">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
            SELECT LAST_INSERT_ID()
        </selectKey>
        insert into m_user
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="@Ognl@isNotEmpty(name)">
                name,
            </if>
            <if test="@Ognl@isNotEmpty(password)">
                password,
            </if>
            <if test="@Ognl@isNotEmpty(gender)">
                gender,
            </if>
            <if test="@Ognl@isNotEmpty(idCard)">
                id_card,
            </if>
            <if test="@Ognl@isNotEmpty(status)">
                status,
            </if>
            <if test="@Ognl@isNotEmpty(tel)">
                tel,
            </if>
            <if test="@Ognl@isNotEmpty(userId)">
                user_id,
            </if>
            <if test="@Ognl@isNotEmpty(qq)">
                qq,
            </if>
            <if test="@Ognl@isNotEmpty(resId)">
                res_id,
            </if>
            <if test="@Ognl@isNotEmpty(email)">
                email,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="@Ognl@isNotEmpty(name)">
                #{name},
            </if>
            <if test="@Ognl@isNotEmpty(password)">
                #{password},
            </if>
            <if test="@Ognl@isNotEmpty(gender)">
                #{gender},
            </if>
            <if test="@Ognl@isNotEmpty(idCard)">
                #{idCard},
            </if>
            <if test="@Ognl@isNotEmpty(status)">
                #{status},
            </if>
            <if test="@Ognl@isNotEmpty(tel)">
                #{tel},
            </if>
            <if test="@Ognl@isNotEmpty(userId)">
                #{userId},
            </if>
            <if test="@Ognl@isNotEmpty(qq)">
                #{qq},
            </if>
            <if test="@Ognl@isNotEmpty(resId)">
                #{resId},
            </if>
            <if test="@Ognl@isNotEmpty(email)">
                #{email},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="MUser">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update m_user
        <set>
            <if test="@Ognl@isNotEmpty(name)">
                name = #{name},
            </if>
            <if test="@Ognl@isNotEmpty(password)">
                password = #{password},
            </if>
            <if test="@Ognl@isNotEmpty(gender)">
                gender = #{gender},
            </if>
            <if test="@Ognl@isNotEmpty(idCard)">
                id_card = #{idCard},
            </if>
            <if test="@Ognl@isNotEmpty(status)">
                status = #{status},
            </if>
            <if test="@Ognl@isNotEmpty(tel)">
                tel = #{tel},
            </if>
            <if test="@Ognl@isNotEmpty(userId)">
                user_id = #{userId},
            </if>
            <if test="@Ognl@isNotEmpty(qq)">
                qq = #{qq},
            </if>
            <if test="@Ognl@isNotEmpty(resId) and resId>0 ">
                res_id = #{resId},
            </if>
            <if test="@Ognl@isNotEmpty(email)">
                email = #{email},
            </if>
        </set>
        where id = #{id}
    </update>
    <update id="updateByPrimaryKey" parameterType="MUser">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update m_user
        set name = #{name},
        password = #{password},
        gender = #{gender},
        id_card = #{idCard},
        status = #{status},
        tel = #{tel},
        user_id = #{userId},
        qq = #{qq},
        res_id = #{resId},
        email = #{email}
        where id = #{id}
    </update>

    <select id="getListPage" parameterType="MUser" resultMap="BaseResultMap">
        select <include refid="Base_Column_List"/> FROM m_user
        <where>
            status &lt;&gt; '2'
            <if test="@Ognl@isNotEmpty(mUser.name)"> AND (`name` LIKE CONCAT('%',#{mUser.name},'%')
                OR user_id LIKE CONCAT('%',#{mUser.name},'%'))
            </if>
        </where>
    </select>

    <insert id="createMuser" parameterType="MUser" useGeneratedKeys="true" keyProperty="id">
        insert into m_user (name, password, gender, id_card, status, tel, user_id,
        qq, res_id, email)
        values (#{name}, #{password}, #{gender}, #{idCard}, #{status}, #{tel}, #{userId},
        #{qq}, #{resId}, #{email})
    </insert>

    <update id="deleteByIds" parameterType="String">
        UPDATE m_user SET status = #{status} WHERE id in (${item})
    </update>
    
    <update id="passwordReset" parameterType="String">
        UPDATE m_user SET password = #{password} WHERE id IN (${item})
    </update>

    <select id="findUserId" parameterType="String" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/> FROM m_user WHERE user_id = #{userId} AND status &lt;&gt; '2'
    </select>

</mapper>
